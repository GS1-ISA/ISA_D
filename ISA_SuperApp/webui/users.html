<!doctype html>
<html>
  <head>
    <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>ISA â€” Users</title>
    <script src="https://cdn.jsdelivr.net/npm/htmx.org@2.0.6/dist/htmx.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/htmx.org@2.0.6/dist/ext/sse.js"></script>
    <link rel="stylesheet" href="/static/tokens.css"><link rel="stylesheet" href="/static/styles.css">
  </head>
  <body>
    <header class="topbar">
      <div class="wrap">
        <strong>ISA â€” Intelligent Standards Assistant</strong>
        <a class="bell" href="/ui/alerts">ðŸ””</a>
        <div class="nav">
          <a class="active" href="/ui/users">Users</a>
          <a href="/ui/admin">Admin</a>
          <a href="/ui/graph">Graph</a>
          <a href="/ui/login" style="margin-left:auto">Login</a>
        </div>
      </div>
    </header>
    <div class="wrap grid">
      <section class="panel chat">
        <h3>Chat</h3>
        <div class="row">
          <input id="q" name="question" placeholder="Ask ISA..." />
          <button id="ask" hx-post="/ui/chat/ask" hx-target="#chatlog" hx-swap="beforeend" hx-include="[name='question']">Ask</button>
          <button id="ask-stream"
                  hx-ext="sse"
                  hx-sse="connect:/ui/chat/ask_stream?question_dummy=1"
                  hx-sse-swap="message"
                  hx-target="#chatlog"
                  hx-swap="beforeend"
                  hx-include="[name='question']"
                  hx-post="/ui/chat/ask_stream_init">
            Ask (Stream)
          </button>
        </div>
        <div id="chatlog"></div>
      </section>
      <script>
        document.getElementById('q').addEventListener('input', function() {
          var question = encodeURIComponent(this.value);
          var streamButton = document.getElementById('ask-stream');
          streamButton.setAttribute('hx-sse', 'connect:/ui/chat/ask_stream?question=' + question);
        });
      </script>
      <section class="panel docgen">
        <h3>Document Generator</h3>
        <input id="doc-title" name="title" placeholder="Title (e.g., ESG Compliance Brief)" />
        <textarea id="doc-outline" name="outline" placeholder="Outline or bullet points"></textarea>
        <div class="row">
          <button id="gen-doc"
                  hx-post="/ui/doc/generate"
                  hx-target="#doc-out-container"
                  hx-swap="innerHTML"
                  hx-indicator="#doc-loading"
                  hx-include="[name='title'], [name='outline']">
            Generate
          </button>
          <span id="doc-loading" class="htmx-indicator">Generating...</span>
        </div>
        <div id="doc-out-container">
          <pre id="doc-out"></pre>
          <a id="dl-link" href="#" download style="display:none">Download</a>
        </div>
      </section>
      <section class="panel memory">
        <h3>Memory Browser</h3>
        <div class="row">
          <input id="mem-q" name="query" placeholder="Search memory..."
                 hx-post="/ui/memory/search"
                 hx-trigger="keyup changed delay:500ms"
                 hx-target="#mem-list"
                 hx-swap="innerHTML"
                 hx-indicator="#mem-loading" />
          <span id="mem-loading" class="htmx-indicator">Loading...</span>
        </div>
        <ul id="mem-list"></ul>
      </section>
      <section class="panel esg">
        <h3>ESG Standards Lookup</h3>
        <div class="row">
          <input id="esg-q" name="query" placeholder="e.g., CO2 lifecycle score, recycled content, FSC certificate" style="flex:1"/>
          <button id="esg-go"
                  hx-post="/ui/esg/search"
                  hx-target="#esg-results"
                  hx-swap="innerHTML"
                  hx-indicator="#esg-loading"
                  hx-include="[name='query']">
            Lookup
          </button>
          <span id="esg-loading" class="htmx-indicator">Searching...</span>
        </div>
        <div id="esg-results"></div>
      </section>
      <section class="panel">
        <h3>Projects</h3>
        <div class="row">
          <button id="proj-add" hx-get="/ui/projects/new" hx-target="#proj-list" hx-swap="beforebegin">New Project</button>
        </div>
        <div id="proj-list" hx-get="/projects" hx-trigger="load"></div>
      </section>
      <section class="panel simulate">
        <h3>Scenario Simulation</h3>
        <div class="row">
          <select id="sim-type" name="type"><option value="regulation">New EU regulation</option><option value="adoption">Tech adoption shift</option></select>
          <input id="sim-param" name="param" placeholder="e.g., 20% increase, 2026 Q1" />
          <button id="sim-run"
                  hx-post="/ui/simulate"
                  hx-target="#sim-out"
                  hx-swap="innerHTML"
                  hx-indicator="#sim-loading"
                  hx-include="[name='type'], [name='param']">
            Run
          </button>
          <span id="sim-loading" class="htmx-indicator">Running...</span>
        </div>
        <pre id="sim-out"></pre>
      </section>
    </div>
    <footer class="footer"><div class="wrap">Design tokens from Figma Â· Data from GS1/EFRAG/EUR-Lex Â· OpenRouter powers the LLM.</div></footer>
  </body>
</html>
